import{_ as X}from"./whisper-BqMPlqUz.js";import{d as O,c as D,l as ee,f as v,j as r,q as n,w as c,k as m,bq as h,t as $,Y as F,A as oe,G as C,z as w,h as I,r as p,b as ne,F as x,x as te}from"./@vue-CubVVfkF.js";import{L as se,u as ae,f as le,_ as V,Z as ce,$ as ie}from"./index-CvfRboU1.js";import{F as ue,M as re,Q as _e,B as pe,i as N,O as me,m as fe,G as de,a as ve,f as ge,g as we,J as he,j as ke,H as ye}from"./naive-ui-Ck8OEwu2.js";import{q as be,r as $e,s as Fe,t as ze}from"./@vicons-CuMc_a8r.js";import{_ as qe}from"./post-skeleton-Db_cmJlj.js";import{_ as Te}from"./main-nav.vue_vue_type_style_index_0_lang-D42wzL-t.js";import{Y as Be}from"./v3-infinite-loading-DH9ovp49.js";import{b as Me}from"./vue-router-CQXvDuJO.js";import"./vuex-CXREYFZm.js";import"./axios-NIGUFBhG.js";import"./moment-CvIcpsue.js";/* empty css               */import"./seemly-s2h2JshW.js";import"./vueuc-Dmj3j_oC.js";import"./evtd-CI_DDEu_.js";import"./@css-render-D_aM2a22.js";import"./vooks-hwk9FHDf.js";import"./vdirs-DRH9Xvnd.js";import"./@juggle-BAaFDRb-.js";import"./css-render-DYRmsh0A.js";import"./@emotion-WldOFDRm.js";import"./lodash-es-CO3YFt-b.js";import"./treemate-HRdUPn5m.js";import"./async-validator-CFA_igpM.js";import"./date-fns-Db9XENWt.js";const Pe={class:"follow-item"},Se={class:"nickname-wrap"},Ue={class:"username-wrap"},Ce={class:"user-info"},Ie={class:"info-item"},xe={class:"info-item"},Ne={class:"item-header-extra"},Oe=O({__name:"follow-item",props:{contact:{}},emits:["send-whisper"],setup(P,{emit:d}){const i=ue(),_=d,t=e=>()=>I(N,null,{default:()=>I(e)}),z=()=>{i.success({title:"提示",content:"确定"+(o.contact.is_following?"取消关注 @":"关注 @")+o.contact.username+" 吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{o.contact.is_following?ae({user_id:o.contact.user_id}).then(e=>{window.$message.success("取消关注成功"),o.contact.is_following=!1}).catch(e=>{console.log(e)}):le({user_id:o.contact.user_id}).then(e=>{window.$message.success("关注成功"),o.contact.is_following=!0}).catch(e=>{console.log(e)})}})},o=P,f=D(()=>{let e=[{label:"私信 @"+o.contact.username,key:"whisper",icon:t($e)}];return o.contact.is_following?e.push({label:"取消关注 @"+o.contact.username,key:"unfollow",icon:t(Fe)}):e.push({label:"关注 @"+o.contact.username,key:"follow",icon:t(ze)}),e}),s=e=>{switch(e){case"follow":case"unfollow":z();break;case"whisper":const a={id:o.contact.user_id,avatar:o.contact.avatar,username:o.contact.username,nickname:o.contact.nickname,is_admin:!1,is_friend:!0,is_following:!1,created_on:0,follows:0,followings:0,status:1};_("send-whisper",a);break}};return(e,a)=>{const g=fe,k=ee("router-link"),q=me,y=pe,T=_e,B=re;return r(),v("div",Pe,[n(B,{"content-indented":""},{avatar:c(()=>[n(g,{size:54,src:e.contact.avatar},null,8,["src"])]),header:c(()=>[m("span",Se,[n(k,{onClick:a[0]||(a[0]=oe(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{s:e.contact.username}}},{default:c(()=>[C(w(e.contact.nickname),1)]),_:1},8,["to"])]),m("span",Ue," @"+w(e.contact.username),1),e.contact.is_following?(r(),$(q,{key:0,class:"top-tag",type:"success",size:"small",round:""},{default:c(()=>[...a[1]||(a[1]=[C(" 已关注 ",-1)])]),_:1})):F("",!0),m("div",Ce,[m("span",Ie," UID. "+w(e.contact.user_id),1),m("span",xe,w(h(se)(e.contact.created_on))+" 加入 ",1)])]),"header-extra":c(()=>[m("div",Ne,[n(T,{placement:"bottom-end",trigger:"click",size:"small",options:f.value,onSelect:s},{default:c(()=>[n(y,{quaternary:"",circle:""},{icon:c(()=>[n(h(N),null,{default:c(()=>[n(h(be))]),_:1})]),_:1})]),_:1},8,["options"])])]),_:1})])}}}),De=V(Oe,[["__scopeId","data-v-7df56cf7"]]),Ve={key:0,class:"skeleton-wrap"},je={key:1},We={key:0,class:"empty-wrap"},Ae={class:"load-more-wrap"},Ge={class:"load-more-spinner"},He=O({__name:"Following",setup(P){const d=Me(),i=p(!1),_=p(!1),t=p([]),z=d.query.n||"粉丝详情",o=d.query.s||"",f=p(d.query.t||"follows"),s=p(+d.query.p||1),e=p(20),a=p(0),g=p(!1),k=p({id:0,avatar:"",username:"",nickname:"",is_admin:!1,is_friend:!0,is_following:!1,created_on:0,follows:0,followings:0,status:1});function q(u){t.value=[],i.value=!1,_.value=!1,s.value=1,a.value=0,f.value=u}const y=D(()=>f.value=="follows"?"没有更多关注了":"没有更多粉丝了"),T=u=>{k.value=u,g.value=!0},B=()=>{g.value=!1},j=()=>{s.value<a.value||a.value==0?(_.value=!1,s.value++,M()):_.value=!0},W=u=>{q(u),M()},M=()=>{f.value==="follows"?A(o):f.value==="followings"&&G(o)},A=(u,b=!1)=>{t.value.length===0&&(i.value=!0),ce({username:u,page:s.value,page_size:e.value}).then(l=>{i.value=!1,l.list.length===0&&(_.value=!0),s.value>1?t.value=t.value.concat(l.list):(t.value=l.list,b&&setTimeout(()=>{window.scrollTo(0,99999)},50)),a.value=Math.ceil(l.pager.total_rows/e.value)}).catch(l=>{i.value=!1,s.value>1&&s.value--})},G=(u,b=!1)=>{t.value.length===0&&(i.value=!0),ie({username:u,page:s.value,page_size:e.value}).then(l=>{i.value=!1,l.list.length===0&&(_.value=!0),s.value>1?t.value=t.value.concat(l.list):(t.value=l.list,b&&setTimeout(()=>{window.scrollTo(0,99999)},50)),a.value=Math.ceil(l.pager.total_rows/e.value)}).catch(l=>{i.value=!1,s.value>1&&s.value--})};return ne(()=>{M()}),(u,b)=>{const l=Te,S=we,H=ge,L=qe,R=he,Y=De,E=ye,J=X,Q=de,Z=ke,K=ve;return r(),v(x,null,[m("div",null,[n(l,{title:h(z),back:!0},null,8,["title"]),n(Q,{class:"main-content-wrap",bordered:""},{default:c(()=>[n(H,{type:"line",animated:"","default-value":f.value,"onUpdate:value":W},{default:c(()=>[n(S,{name:"follows",tab:"正在关注"}),n(S,{name:"followings",tab:"我的粉丝"})]),_:1},8,["default-value"]),i.value&&t.value.length===0?(r(),v("div",Ve,[n(L,{num:e.value},null,8,["num"])])):(r(),v("div",je,[t.value.length===0?(r(),v("div",We,[n(R,{size:"large",description:"暂无数据"})])):F("",!0),(r(!0),v(x,null,te(t.value,U=>(r(),$(E,{key:U.user_id},{default:c(()=>[n(Y,{contact:U,onSendWhisper:T},null,8,["contact"])]),_:2},1024))),128))])),n(J,{show:g.value,user:k.value,onSuccess:B},null,8,["show","user"])]),_:1})]),a.value>0?(r(),$(K,{key:0,justify:"center"},{default:c(()=>[n(h(Be),{class:"load-more",slots:{complete:y.value,error:"加载出错"},onInfinite:j},{spinner:c(()=>[m("div",Ae,[_.value?F("",!0):(r(),$(Z,{key:0,size:14})),m("span",Ge,w(_.value?y.value:"加载更多"),1)])]),_:1},8,["slots"])]),_:1})):F("",!0)],64)}}}),wo=V(He,[["__scopeId","data-v-1505376e"]]);export{wo as default};
